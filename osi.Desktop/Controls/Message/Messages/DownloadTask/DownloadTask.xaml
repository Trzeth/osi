<local:BaseMessage x:Class="osi.Desktop.DownloadTask"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
                   xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                   xmlns:local="clr-namespace:osi.Desktop"
                   mc:Ignorable="d" 
                   d:DesignHeight="90" d:DesignWidth="350"
                   Width="{StaticResource MessageWidth}"
                   MinHeight="{StaticResource MessageSuggestHeight}"
                   xmlns:core="clr-namespace:osi.Core;assembly=osi.Core"
                   xmlns:downloadmgr="clr-namespace:osi.Core.DownloadManager;assembly=osi.Core"
                   >
    <!--<local:BaseMessage.DataContext>
        <Binding Source="{x:Static core:DownloadTaskDesignModel.Instance}" Mode="OneTime"/>
    </local:BaseMessage.DataContext>-->
    <local:BaseMessage.Resources>
        <Style x:Key="ContentStyle" TargetType="{x:Type ContentControl}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ContentControl}">
                        <Grid Margin="5">
                            <Grid.Effect>
                                <DropShadowEffect ShadowDepth="0" Opacity="0.15" />
                            </Grid.Effect>

                            <Grid>
                                <Grid.Clip>
                                    <CombinedGeometry>
                                        <CombinedGeometry.Geometry1>
                                            <RectangleGeometry RadiusX="3" RadiusY="3" Rect="0,0,340,80">
                                            </RectangleGeometry>
                                        </CombinedGeometry.Geometry1>
                                    </CombinedGeometry>
                                </Grid.Clip>

                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Name="ProgressBarHeight" Height="0.15*"/>
                                </Grid.RowDefinitions>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="0.15*"/>
                                    <ColumnDefinition Name="SideBarWidth" Width="*"/>
                                </Grid.ColumnDefinitions>

                                <local:DownloadTaskProgressBar Grid.ColumnSpan="2" 
                                                               Grid.RowSpan="2" 
                                                               ProgressBarHeight="{Binding ElementName=ProgressBarHeight,Path=Height}"
                                                               SideBarWidth="{Binding ElementName=SideBarWidth,Path=Width}"
                                                               DownloadingStatus="{Binding Path=DownloadStatus+DownloadingStatus}"
                                                               Progress="{Binding Path=DownloadStatus+Progres}"
                                                               />

                                <!-- Beatmapset Information -->
                                <Grid Grid.Row="0" Grid.Column="1" SnapsToDevicePixels="True" Background="{StaticResource BackgroundLightBrush}">
                                    <Grid.Clip>
                                        <CombinedGeometry>
                                            <CombinedGeometry.Geometry1>
                                                <RectangleGeometry RadiusX="3" RadiusY="3" Rect="0,0,296,70">
                                                </RectangleGeometry>
                                            </CombinedGeometry.Geometry1>
                                        </CombinedGeometry>

                                    </Grid.Clip>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width='*'/>
                                        </Grid.ColumnDefinitions>

                                        <Image Height="70" MinWidth="{Binding Path=Height,RelativeSource={RelativeSource Mode=Self}}" Stretch="UniformToFill" Source="{Binding Path=BeatmapsetId,Converter={local:BeatmapsetIdToImageConverter}}"/>

                                        <Grid Grid.Column="1" Margin="5,5">
                                            <StackPanel VerticalAlignment="Top">
                                                <TextBlock FontSize="{StaticResource FontSizeRegular}"
                                                           Text="{Binding Title}"
                                                           />
                                                <TextBlock FontSize="{StaticResource FontSizeSmall}"
                                                           Text="{Binding Artist}"
                                                           />
                                            </StackPanel>

                                            <StackPanel VerticalAlignment="Bottom" Orientation="Horizontal">
                                                <TextBlock FontSize="{StaticResource FontSizeSmall}"
                                                           Text="{Binding Creator}"
                                                           />
                                                <TextBlock FontSize="{StaticResource FontSizeSmall}"
                                                           Margin="5,0,5,0"
                                                           >
                                                    <TextBlock.Text>
                                                        <Binding Path="Length" 
                                                                 StringFormat="[{0:mm}:{0:ss}]"
                                                                 />
                                                    </TextBlock.Text>
                                                </TextBlock>
                                                <TextBlock FontSize="{StaticResource FontSizeSmall}"
                                                           Margin="5,0,5,0"
                                                           Text="{Binding BPM,StringFormat={}{0}~}"
                                                           >
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </Grid>
                        <!--<ControlTemplate.Triggers>
                            <DataTrigger Binding="{Binding Path=DownloadStatus.DownloadingStatus}" Value="{x:Static downloadmgr:DownloadingStatus.Error}">
                                <Setter TargetName="BackgroundPlaceHolder" Property="Visibility" Value="Visible"/>

                                <Setter TargetName="ProgressText" Property="Visibility" Value="Hidden"/>

                                <Setter TargetName="ProgressPlaceHolder" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="ProgressPlaceHolder" Property="TextBlock.Text" Value="错误"/>

                                <Setter TargetName="RetryButton" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="DownloadIcon" Property="Visibility" Value="Hidden"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Path=DownloadStatus.DownloadingStatus}" Value="{x:Static downloadmgr:DownloadingStatus.Downloading}">
                                <Setter TargetName="BackgroundPlaceHolder" Property="Visibility" Value="Hidden"/>

                                <Setter TargetName="ProgressText" Property="Visibility" Value="Visible"/>

                                <Setter TargetName="ProgressPlaceHolder" Property="Visibility" Value="Hidden"/>

                                <Setter TargetName="RetryButton" Property="Visibility" Value="Hidden"/>
                                <Setter TargetName="DownloadIcon" Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Path=DownloadStatus.DownloadingStatus}" Value="{x:Static downloadmgr:DownloadingStatus.Complete}">
                                <Setter TargetName="ProgressText" Property="Visibility" Value="Hidden"/>
                                <Setter TargetName="ProgressPlaceHolder" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="ProgressPlaceHolder" Property="TextBlock.Text" Value="完成"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>-->
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </local:BaseMessage.Resources>

    <ContentControl Style="{StaticResource ContentStyle}"
                    d:DataContext="{x:Static core:DownloadTaskDesignModel.Instance}"/>
</local:BaseMessage>
